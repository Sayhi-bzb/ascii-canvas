# ASCII Canvas

[English](./README.md) | [简体中文](./README.zh-CN.md) | 日本語 | [한국어](./README.ko.md)

React と TypeScript で構築されたブラウザベースの ASCII アートエディタ。直感的なキャンバスインターフェースで ASCII 描画を作成でき、複数の描画ツール、元に戻す/やり直し機能、リアルタイムレンダリングを備えています。

## 機能

- **複数の描画ツール**：選択、ブラシ、線、ボックス、消しゴム、塗りつぶしツール
- **テキスト入力モード**：カーソルナビゲーション付きの直接テキスト入力
- **選択とクリップボード**：領域の選択、ASCII コンテンツのコピー/切り取り/貼り付け
- **元に戻す/やり直し**：Yjs と Zundo による完全な履歴管理
- **キャンバスナビゲーション**：マウス/タッチジェスチャーによるパンとズーム
- **エクスポート**：作品をクリップボードにコピー
- **全角文字サポート**：全角文字（CJK）を正しく処理

## 技術スタック

- **フレームワーク**：React 19 + TypeScript
- **ビルドツール**：Vite
- **状態管理**：Zustand with Zundo（元に戻す/やり直し用）
- **スタイリング**：Tailwind CSS
- **UI コンポーネント**：Radix UI プリミティブ
- **通知**：Sonner
- **ジェスチャー**：@use-gesture/react
- **コラボレーション対応**：Yjs による共有データ構造

## プロジェクト構造

```
src/
├── components/
│   ├── AsciiCanvas/          # メインキャンバスコンポーネント
│   │   ├── hooks/            # useCanvasInteraction, useCanvasRenderer
│   │   └── index.tsx
│   ├── Toolbar.tsx           # 描画ツール UI
│   └── ui/                   # Radix UI コンポーネント
├── store/
│   └── canvasStore.ts        # Zustand ストア（キャンバス状態）
├── utils/
│   ├── char.ts               # 文字幅検出
│   ├── export.ts             # 文字列へのエクスポート
│   ├── shapes.ts             # 線/ボックス描画アルゴリズム
│   ├── selection.ts          # 選択範囲の境界計算
│   └── math.ts               # グリッド/スクリーン座標変換
├── lib/
│   ├── constants.ts          # アプリ定数（ズーム制限など）
│   ├── yjs-setup.ts          # Yjs 設定
│   └── utils.ts              # 共通ユーティリティ
└── types/
    └── index.ts              # TypeScript 型定義
```

## はじめに

### 前提条件

- Node.js（バージョン 18 以上を推奨）
- npm または yarn

### インストール

```bash
# リポジトリをクローン
git clone <repository-url>
cd ascii-canvas

# 依存関係をインストール
npm install
```

### 開発

```bash
# ホットリロード付き開発サーバーを起動
npm run dev
```

ブラウザで [http://localhost:5173](http://localhost:5173) を開きます。

### ビルド

```bash
# 型チェックと本番用ビルド
npm run build

# 本番ビルドをプレビュー
npm run preview
```

### リント

```bash
# ESLint を実行
npm run lint

# Knip で未使用のエクスポートを検出
npm run knip
```

## 使い方

### 描画ツール

- **選択**：クリックでテキストカーソルを配置、ドラッグで選択範囲を作成
- **ブラシ**：現在のブラシ文字でフリーハンド描画
- **線**：直線を描画
- **ボックス**：矩形の輪郭を描画
- **塗りつぶし**：選択した領域を文字で塗りつぶす
- **消しゴム**：キャンバスから文字を削除

### キーボードショートカット

- `Ctrl/Cmd + Z`：元に戻す
- `Ctrl/Cmd + Shift + Z` または `Ctrl/Cmd + Y`：やり直す
- `Ctrl/Cmd + C`：選択範囲をコピー
- `Ctrl/Cmd + X`：選択範囲を切り取り
- `Ctrl/Cmd + V`：貼り付け
- `Delete` または `Backspace`：選択範囲を削除
- `Esc`：テキスト入力モードを終了
- 矢印キー：テキストカーソルを移動

### キャンバスナビゲーション

- **パン**：マウスでクリック＆ドラッグ
- **ズーム**：マウスホイールまたはピンチジェスチャー

## アーキテクチャのハイライト

### 状態管理

このアプリは、Yjs を基盤データ構造として Zustand を使用した状態管理を採用しています。これにより以下が可能になります：

- Yjs トランザクションによる効率的な元に戻す/やり直し
- リアルタイムコラボレーションの可能性
- イミュータブルな更新パターン

### レンダリング

キャンバスは HTML5 Canvas API とカスタムレンダラー（`useCanvasRenderer`）を使用します：

- パフォーマンスのために可視グリッドセルのみをレンダリング
- 描画中のプレビュー用スクラッチレイヤーをサポート
- 全角文字（CJK）を正しく処理

### 描画アルゴリズム

- **線**：Bresenham の直線アルゴリズム
- **ボックス**：コーナー間の矩形描画
- **選択**：境界計算を伴うマルチリージョンサポート

## コントリビューション

コントリビューションを歓迎します！お気軽に Issue や Pull Request を送信してください。

## ライセンス

MIT
